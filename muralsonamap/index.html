<!DOCTYPE html>
<html>
<head>

    <title>Murals on a Map</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <script src="js/jquery-3.5.1.min.js"></script>

    <link rel="stylesheet" href="js/leaflet.css" />
    <script src="js/leaflet.js"></script>

    <style>

        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
        }
        #mmap {
            float: left;
            margin: 0;
            width: 100%;
            height: 100%;
        }

    </style>

</head>
<body>

<div id='mmap'></div>

<script>
    $(document).ready(function() {
        initmap();
    });

    var m_map;
    var murals_data = 1;
    var murals_markers = new L.FeatureGroup();

    var IconMural = function(latlng, properties) {
        var bg_color = "#FFFFFF";
        return L.circleMarker(latlng, {
            radius: 8,
            fillColor: bg_color,
            color: "#000000",
            weight: 3,
            opacity: 1,
            fillOpacity: 0.6
        })
    };


    function initmap() {
        // set up the map
        m_map = new L.Map('mmap', {zoomControl: false});
        var UTRECHT_DOM = [52.0906, 5.1214];
        //get our map
        var osmUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
        var osmAttrib = '&copy; <a href = "https://www.openstreetmap.org/copyright">  OpenStreetMap </a> contributors';
        var osm = new L.TileLayer(osmUrl, {minZoom: 4, maxZoom: 19, attribution: osmAttrib});
        m_map.addLayer(osm);

        m_map.attributionControl.setPrefix('');
        m_map.setView(UTRECHT_DOM, 13);

        load_murals_data();
    }

    function load_murals_data() {
        console.log("LOAD MURALS DATA START");
        var ajax = $.ajax({
            type : 'GET',
            url : 'data/murals.json',
            success : function (response) {
                //console.log("MURALS DATA RESPONSE OK");
                //console.log(response);
                murals_data = response;
                draw_murals();
            },
            error: function(response){
                console.log("ERROR MURALS LOADING");
                //console.log(response);
            }
        });
    }

    function draw_murals() {
        console.log("START DRAW MURALS");
        murals_markers.clearLayers();
        //L.geoJSON(murals_data).addTo(murals_markers);

        //loop through murals_data
        var geojson = L.geoJson(murals_data, {
            pointToLayer: function(feature, latlng) {
                return new IconMural(latlng, feature.properties);
            },
            onEachFeature: function (feature, layer) {
                console.log(feature);
                //var mural_pos = new L.LatLng(feature.geometry.coordinates[0],feature.geometry.coordinates[1]);
                var popup_txt = 'Titel: ' + feature.properties.name + '<br/>' ;
                popup_txt +=  'Artiest: ' + feature.properties.artist + '<br/>';
                popup_txt +=  '<img src="img/' + feature.properties.image + '" alt="Foto"/>';

                //var mural_icon = IconMural(mural_pos).bindPopup(popup_txt);
                layer.bindPopup(popup_txt);
                //murals_markers.addLayer(mural_icon);
                //console.log("add");
                //murals_markers.addLayer(L.marker([feature.geometry.coordinates[0],feature.geometry.coordinates[1]]));
                //console.log("2");
                //layer.bindPopup(feature.properties.name);
            }
        });

        geojson.addTo(m_map);
        //console.log(murals_markers);
        //m_map.addLayer(murals_markers);
    }

</script>

</body>
</html>
